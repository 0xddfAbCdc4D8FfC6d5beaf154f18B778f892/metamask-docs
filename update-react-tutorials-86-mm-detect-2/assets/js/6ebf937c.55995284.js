"use strict";(self.webpackChunkmetamask_docs=self.webpackChunkmetamask_docs||[]).push([[5690],{69315:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var s=n(74848),r=n(28453);const i={description:"Create a multi-component React dapp with global state using EIP-6963.",toc_max_heading_level:4,sidebar_position:2},o="Create a React dapp with global state",a={id:"tutorials/react-dapp-global-state",title:"Create a React dapp with global state",description:"Create a multi-component React dapp with global state using EIP-6963.",source:"@site/wallet/tutorials/react-dapp-global-state.md",sourceDirName:"tutorials",slug:"/tutorials/react-dapp-global-state",permalink:"/update-react-tutorials-86-mm-detect-2/wallet/tutorials/react-dapp-global-state",draft:!1,unlisted:!1,editUrl:"https://github.com/MetaMask/metamask-docs/edit/main/wallet/tutorials/react-dapp-global-state.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{description:"Create a multi-component React dapp with global state using EIP-6963.",toc_max_heading_level:4,sidebar_position:2},sidebar:"walletSidebar",previous:{title:"Create a React dapp with local state",permalink:"/update-react-tutorials-86-mm-detect-2/wallet/tutorials/react-dapp-local-state"},next:{title:"Create a simple dapp",permalink:"/update-react-tutorials-86-mm-detect-2/wallet/tutorials/javascript-dapp-simple"}},l={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Steps",id:"steps",level:2},{value:"1. Set up the project",id:"1-set-up-the-project",level:3},{value:"Styling",id:"styling",level:4},{value:"Project structure",id:"project-structure",level:4},{value:"2. Import EIP-6963 interfaces",id:"2-import-eip-6963-interfaces",level:3},{value:"2. Build the context provider",id:"2-build-the-context-provider",level:3},{value:"3. Wrap components with the context provider",id:"3-wrap-components-with-the-context-provider",level:3},{value:"4. Create the components that discover, list and connect to installed wallets",id:"4-create-the-components-that-discover-list-and-connect-to-installed-wallets",level:3},{value:"5. Display MetaMask data",id:"5-display-metamask-data",level:3},{value:"6. Show MetaMask errors in the footer",id:"6-show-metamask-errors-in-the-footer",level:3},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"create-a-react-dapp-with-global-state",children:"Create a React dapp with global state"}),"\n",(0,s.jsxs)(t.p,{children:["This tutorial walks you through integrating a React dapp with MetaMask.\nThe dapp has multiple components, and requires managing state globally.\nYou'll use the ",(0,s.jsx)(t.a,{href:"https://v3.vitejs.dev/guide",children:"Vite"})," build tool with React and TypeScript to create\nthe dapp."]}),"\n",(0,s.jsx)(t.admonition,{type:"tip",children:(0,s.jsxs)(t.p,{children:["We recommend first completing the ",(0,s.jsx)(t.a,{href:"/update-react-tutorials-86-mm-detect-2/wallet/tutorials/react-dapp-local-state",children:"creating a React dapp with local state"})," tutorial, which contains important information and introduces [EIP-6963](",(0,s.jsx)(t.a,{href:"https://eips.ethereum.org/EIPS/eip-6963",children:"https://eips.ethereum.org/EIPS/eip-6963"}),". If you skip the first tutorial, ensure you review ",(0,s.jsx)(t.a,{href:"/update-react-tutorials-86-mm-detect-2/wallet/concepts/wallet-interoperability",children:"wallet interoperability"})," documentation to learn about multiple injected wallet providers."]})}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.a,{href:"/update-react-tutorials-86-mm-detect-2/wallet/tutorials/react-dapp-local-state",children:"previous tutorial"})," walks you through creating a dapp that uses EIP-6963. It demonstrates how to iterate over all discovered providers, connect to the selected wallet, and remember the selection, all within a single component."]}),"\n",(0,s.jsx)(t.p,{children:"In real world use cases, a dapp usually shares global state across many components."}),"\n",(0,s.jsxs)(t.p,{children:["In this tutorial, the state is put into a ",(0,s.jsx)(t.a,{href:"https://react.dev/reference/react/useContext",children:"React Context"})," component, creating a ",(0,s.jsx)(t.a,{href:"https://react.dev/learn/reusing-logic-with-custom-hooks#custom-hooks-sharing-logic-between-components",children:"global state"}),"\nthat allows other components and UI elements to benefit from its data and functions.\nThis process involves re-evaluating the synchronization of the wallet state and ensuring the persistence of the selected wallet using localStorage.\nThis ensuers that the last connected wallet state remains intact even after a page refresh."]}),"\n",(0,s.jsxs)(t.p,{children:["Finally, this tutorial addresses the edge case where a browser wallet may be disabled or uninstalled between refreshes.\nA disconnect function is added to reset the state and use ",(0,s.jsx)(t.a,{href:"/wallet/reference/wallet_revokePermissions",children:(0,s.jsx)(t.code,{children:"wallet_revokePermissions"})})," to properly disconnect from MetaMask."]}),"\n",(0,s.jsx)(t.admonition,{title:"Project source code",type:"info",children:(0,s.jsxs)(t.p,{children:["You can view the ",(0,s.jsx)(t.a,{href:"https://github.com/MetaMask/vite-react-global-tutorial",children:"dapp source code on GitHub"}),"."]})}),"\n",(0,s.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"https://nodejs.org/",children:"Node.js"})," version 18+"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"https://docs.npmjs.com/downloading-and-installing-node-js-and-npm",children:"npm"})," version 9+"]}),"\n",(0,s.jsxs)(t.li,{children:["A text editor (for example, ",(0,s.jsx)(t.a,{href:"https://code.visualstudio.com/",children:"VS Code"}),")"]}),"\n",(0,s.jsxs)(t.li,{children:["The ",(0,s.jsx)(t.a,{href:"https://metamask.io/download",children:"MetaMask extension"})," installed"]}),"\n",(0,s.jsx)(t.li,{children:"Basic knowledge of TypeScript, React, React Context and React Hooks"}),"\n",(0,s.jsxs)(t.li,{children:["You have completed the ",(0,s.jsx)(t.a,{href:"/update-react-tutorials-86-mm-detect-2/wallet/tutorials/react-dapp-local-state",children:"Creating a React dapp with local state"})," tutorial"]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"steps",children:"Steps"}),"\n",(0,s.jsx)(t.h3,{id:"1-set-up-the-project",children:"1. Set up the project"}),"\n",(0,s.jsx)(t.p,{children:"This project takes a fresh approach to its structure, the code or last known state from previous tutorials are not used. Instead, this tutorial walks through steps to break the single component structure into multiple components."}),"\n",(0,s.jsx)(t.p,{children:"The previous tutorial minimized steps to discover and connect to wallets, this tutorial prepares for more advanced, real-world scenarios."}),"\n",(0,s.jsx)(t.p,{children:"Begin by creating a new ViteJS project and adding the necessary directory structure:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"npm create vite@latest vite-react-global-state -- --template react-ts\n"})}),"\n",(0,s.jsx)(t.p,{children:"Install the node module dependencies:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"cd vite-react-global-state && npm install\n"})}),"\n",(0,s.jsx)(t.p,{children:"Launch the development server:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"npm run dev\n"})}),"\n",(0,s.jsxs)(t.p,{children:["This displays a ",(0,s.jsx)(t.code,{children:"localhost"})," URL in your terminal, where you can view the dapp in your browser."]}),"\n",(0,s.jsxs)(t.admonition,{title:"tip",type:"note",children:[(0,s.jsxs)(t.p,{children:["If you are using VS Code, you can run the ",(0,s.jsx)(t.code,{children:"code ."})," command to open the project."]}),(0,s.jsxs)(t.p,{children:["If the development server stops, you can use the ",(0,s.jsx)(t.code,{children:"npx vite"})," or\n",(0,s.jsx)(t.code,{children:"npm run dev"})," command to re-run your project."]})]}),"\n",(0,s.jsxs)(t.p,{children:["After you open the ViteJS React project in your editor of choice, add three directories within the ",(0,s.jsx)(t.code,{children:"src"})," directory.\nCreate a ",(0,s.jsx)(t.code,{children:"src/components"}),", ",(0,s.jsx)(t.code,{children:"src/hooks"})," and ",(0,s.jsx)(t.code,{children:"src/utils"})," directory in the root of the project, using the followinng commands:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"mkdir src/components && mkdir src/hooks && mkdir src/utils\n"})}),"\n",(0,s.jsx)(t.p,{children:"Next, create components for listing the installed wallets, displaying the connected wallet information, and handling errors.\nAdditionally, create a CSS module for each component."}),"\n",(0,s.jsxs)(t.p,{children:["Create the following files in ",(0,s.jsx)(t.code,{children:"src/components"}),":"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"SelectedWallet.module.css"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"SelectedWallet.tsx"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"WalletError.module.css"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"WalletError.tsx"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"WalletList.module.css"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"WalletList.tsx"})}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["Create the following files in ",(0,s.jsx)(t.code,{children:"src/hooks"}),":"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"Eip6963Provider.tsx"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"useEip6963Provider.tsx"})}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["Create the following file in ",(0,s.jsx)(t.code,{children:"src/utils"}),":"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"index.ts"})}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"The components, hooks, and utility files are required for the project.\nEach file includes the necessary code to meet the project goals: creating multiple UI components, establishing shared state with a context provider, and implementing custom hooks and helper functions."}),"\n",(0,s.jsx)(t.h4,{id:"styling",children:"Styling"}),"\n",(0,s.jsxs)(t.p,{children:["Add the following CSS to ",(0,s.jsx)(t.code,{children:"SelectedWallet.module.css"}),", ",(0,s.jsx)(t.code,{children:"WalletError.module.css"}),", and ",(0,s.jsx)(t.code,{children:"WalletList.module.css"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-css",metastring:'title="SelectedWallet.module.css"',children:".selectedWallet {\n  display: flex;\n  flex-flow: row nowrap;\n  justify-content: flex-start;\n\n  padding: 0.6em 1.2em;\n  margin-bottom: 0.5em;\n\n  font-family: inherit;\n  font-size: 1em;\n  font-weight: 500;\n}\n.selectedWallet > img {\n  width: 2em;\n  height: 1.5em;\n  margin-right: 1em;\n}\n\n.providers {\n  display: flex;\n  flex-flow: column wrap;\n  justify-content: center;\n  align-items: center;\n  align-content: center;\n\n  padding: 0.6em 1.2em;\n}\n"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-css",metastring:'title="WalletError.module.css"',children:".walletError {\n  margin-top: 1em;\n  border-radius: 0.5em;\n  height: 36px;\n  padding: 16px;\n  color: #EFEFEF;\n  background-color: transparent;\n  user-select: none; /* Standard syntax */\n}\n"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-css",metastring:'title="WalletList.module.css"',children:".walletList {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Replace the existing code in ",(0,s.jsx)(t.code,{children:"src/index.css"})," with the following:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-css",metastring:'title="index.css"',children:":root {\n  font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;\n  line-height: 1.5;\n  font-weight: 400;\n\n  color-scheme: light dark;\n  color: rgba(255, 255, 255, 0.87);\n  background-color: #242424;\n\n  font-synthesis: none;\n  text-rendering: optimizeLegibility;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  text-align: left;\n}\n\na {\n  font-weight: 500;\n  color: #646cff;\n  text-decoration: inherit;\n}\na:hover {\n  color: #535bf2;\n}\n\nbody {\n  margin: 0;\n  display: flex;\n  min-width: 320px;\n  min-height: 100vh;\n}\n\nh1 {\n  font-size: 3.2em;\n  line-height: 1.1;\n}\n\nhr {\n  margin-top: 2em;\n  height: 1px;\n}\n\nbutton {\n  min-width: 12em;\n  display: flex;\n  flex-flow: row nowrap;\n  justify-content: flex-start;\n\n  align-items: center;\n  border-radius: 0.5em;\n  padding: 0.6em 1.2em;\n  margin-bottom: 0.5em;\n\n  font-family: inherit;\n  font-size: 1em;\n  font-weight: 500;\n\n  cursor: pointer;\n\n  transition: border-color 0.25s;\n  border: 1px solid transparent;\n  background-color: #1a1a1a;\n}\nbutton > img {\n  width: 1.5em;\n  height: 1.5em;\n  margin-right: 1em;\n}\nbutton:hover {\n  border-color: #75079d;\n}\nbutton:focus,\nbutton:focus-visible {\n  outline: 4px auto -webkit-focus-ring-color;\n}\nbutton:first-child {\n  margin-top: 0.5em;\n}\nbutton:last-child {\n  margin-bottom: 0;\n}\n\n@media (prefers-color-scheme: light) {\n  :root {\n    color: #213547;\n    background-color: #ffffff;\n  }\n  a:hover {\n    color: #747bff;\n  }\n  button {\n    background-color: #f9f9f9;\n  }\n}\n"})}),"\n",(0,s.jsx)(t.h4,{id:"project-structure",children:"Project structure"}),"\n",(0,s.jsxs)(t.p,{children:["You now have some basic global and component level styling for your application.\nThe directory tree in the dapp's ",(0,s.jsx)(t.code,{children:"/src"})," directory should look similar to the following:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:"\u251c\u2500\u2500 src\n\u2502   \u251c\u2500\u2500 assets\n\u2502   \u251c\u2500\u2500 components\n\u2502   \u2502   \u251c\u2500\u2500  SelectedWallet.module.css\n\u2502   \u2502   \u251c\u2500\u2500  SelectedWallet.tsx\n\u2502   \u2502   \u251c\u2500\u2500  WalletError.module.css\n\u2502   \u2502   \u251c\u2500\u2500  WalletError.tsx\n\u2502   \u2502   \u251c\u2500\u2500  WalletList.module.css\n\u2502   \u2502   \u2514\u2500\u2500  WalletList.tsx\n\u2502   \u251c\u2500\u2500 hooks\n\u2502   \u2502   \u251c\u2500\u2500 Eip6963Provider.tsx\n\u2502   \u2502   \u2514\u2500\u2500 useEip6963Provider.tsx\n\u2502   \u251c\u2500\u2500 utils\n\u2502   \u2502   \u2514\u2500\u2500 index.tsx\n\u251c\u2500\u2500 App.css\n\u251c\u2500\u2500 App.tsx\n\u251c\u2500\u2500 index.css\n\u251c\u2500\u2500 main.tsx\n\u251c\u2500\u2500 vite-env.d.ts\n"})}),"\n",(0,s.jsx)(t.h3,{id:"2-import-eip-6963-interfaces",children:"2. Import EIP-6963 interfaces"}),"\n",(0,s.jsxs)(t.p,{children:["Your dapp will connect to MetaMask using the mechanism introduced by\n",(0,s.jsx)(t.a,{href:"https://eips.ethereum.org/EIPS/eip-6963",children:"EIP-6963"}),"."]}),"\n",(0,s.jsx)(t.admonition,{title:"Why EIP-6963?",type:"info",children:(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://eips.ethereum.org/EIPS/eip-6963",children:"EIP-6963"})," introduces an alternative wallet detection\nmechanism to the ",(0,s.jsx)(t.code,{children:"window.ethereum"})," injected provider.\nThis alternative mechanism enables dapps to support\n",(0,s.jsx)(t.a,{href:"/update-react-tutorials-86-mm-detect-2/wallet/concepts/wallet-interoperability",children:"wallet interoperability"})," by discovering multiple injected\nwallet providers in a user's browser."]})}),"\n",(0,s.jsxs)(t.p,{children:["Update the Vite environment variable file, ",(0,s.jsx)(t.code,{children:"src/vite-env.d.ts"}),", with the types and interfaces\nneeded for ",(0,s.jsx)(t.a,{href:"https://eips.ethereum.org/EIPS/eip-6963",children:"EIP-6963"})," and\n",(0,s.jsx)(t.a,{href:"https://eips.ethereum.org/EIPS/eip-1193",children:"EIP-1193"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-tsx",metastring:'title="vite-env.d.ts"',children:'/// <reference types="vite/client" />\n\ninterface EIP1193Provider {\n  isStatus?: boolean;\n  host?: string;\n  path?: string;\n  sendAsync?: (request: { method: string, params?: Array<unknown> }, callback: (error: Error | null, response: unknown) => void) => void\n  send?: (request: { method: string, params?: Array<unknown> }, callback: (error: Error | null, response: unknown) => void) => void\n  request: (request: { method: string, params?: Array<unknown> }) => Promise<unknown>\n}\n\ninterface EIP6963ProviderInfo {\n  rdns: string;\n  uuid: string;\n  name: string;\n  icon: string;\n}\n\ninterface EIP6963ProviderDetail {\n  info: EIP6963ProviderInfo;\n  provider: EIP1193Provider;\n}\n\ntype EIP6963AnnounceProviderEvent = {\n  detail:{\n    info: EIP6963ProviderInfo,\n    provider: Readonly<EIP1193Provider>\n  }\n}\n\ninterface WalletError {\n  code?: string\n  message?: string\n}\n'})}),"\n",(0,s.jsx)(t.h3,{id:"2-build-the-context-provider",children:"2. Build the context provider"}),"\n",(0,s.jsx)(t.p,{children:"This will be the most involved coding section of the tutorial as we understand what types, interfaces, functions, hooks, events, effects and RPC calls will be needed to create our React Context component that will wrap our application providing all components access to the state and functions required to modify the state and perform connection and disconnection to the discovered wallets."}),"\n",(0,s.jsx)(t.h3,{id:"3-wrap-components-with-the-context-provider",children:"3. Wrap components with the context provider"}),"\n",(0,s.jsx)(t.h3,{id:"4-create-the-components-that-discover-list-and-connect-to-installed-wallets",children:"4. Create the components that discover, list and connect to installed wallets"}),"\n",(0,s.jsx)(t.h3,{id:"5-display-metamask-data",children:"5. Display MetaMask data"}),"\n",(0,s.jsx)(t.h3,{id:"6-show-metamask-errors-in-the-footer",children:"6. Show MetaMask errors in the footer"}),"\n",(0,s.jsx)(t.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,s.jsxs)(t.p,{children:["You can see the ",(0,s.jsx)(t.a,{href:"https://github.com/MetaMask/react-dapp-tutorial/tree/global-state-final",children:"source code"}),"\nfor the final state of this dapp tutorial."]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var s=n(96540);const r={},i=s.createContext(r);function o(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);